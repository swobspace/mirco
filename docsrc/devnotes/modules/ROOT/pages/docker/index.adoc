= Migration to Docker

Just a memo for todos and code snippets ...

== Development

.Build
[source,sh]
----
podman compose -f docker-compose.dev.yml build
podman compose -f docker-compose.dev.yml build --no-cache
----

.Run Application
[source,sh]
----
rm -f tmp/pids/server.pid && \
      podman compose -f docker-compose.dev.yml up -d && \
      podman compose -f docker-compose.dev.yml logs -f
----

.Single Purpose
[source,sh]
----
podman compose -f docker-compose.dev.yml run --rm app
podman compose -f docker-compose.dev.yml restart
podman compose -f docker-compose.dev.yml stop
podman compose -f docker-compose.dev.yml exec app
----

.Cleanup
[source,sh]
----
podman compose -f docker-compose.dev.yml down --remove-orphans
----

.Logging
[source,sh]
----
podman compose -f docker-compose.dev.yml logs | less -r
----

// podman compose -f docker-compose.dev.yml logs |\
//  sed 's/\x1B\[[0-9;]*[JKmsu]//g' | less

== Production Image

.Build
[source,sh]
----
podman build -t mirco .
----

.Inspect image
[source,sh]
----
podman run --rm -it mirco /bin/bash
----

== app/config

=== Master Key

https://guides.rubyonrails.org/7_1_release_notes.html#generate-dockerfiles-for-new-rails-applications

----
podman run -it --rm -p 3000:3000 \
          --env RAILS_MASTER_KEY=000000000000000000000000000000 \
          localhost/mirco
----


== Variables

----
app:
  - RAILS_MASTER_KEY
  - DATABASE_URL
  - REDIS_URL
  - RAILS_SERVE_STATIC_FILES: "enabled"
  - RAILS_LOG_TO_STDOUT: "enabled"

db:
  - POSTGRES_USER
  - POSTGRES_PASSWORD
  - POSTGRES_DB
  - TIMESCALEDB_TELEMETRY: "off"
----

== Command Line Stuff

