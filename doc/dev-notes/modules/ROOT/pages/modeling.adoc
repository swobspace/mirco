= Modeling mirco
:imagesdir: ../images

== Overall Picture

image::models.svg[]

== Home controller

[source,bash]
----
bin/rails g controller Home index \
  --no-stylesheets --no-javascripts --no-helper
----

== model Server

[source,bash]
----
bin/rails g scaffold Server \
  name:string uid:string:index location:string description:text \
  api_url:string api_user:string api_password_ciphertext:text \
  api_user_has_full_access:boolean \
  api_verify_ssl:boolean \
  properties:jsonb \
  last_channel_update:timestamp \
  last_check:timestamp last_check_ok:timestamp \
  --no-stylesheets --no-javascripts --no-helper

bin/rails g migration AddVerifySslToServer api_verify_ssl:boolean
bin/rails g migration AddLastChannelUpdateToServer \
  last_channel_update:timestamp
bin/rails g migration AddLastCheckToServer \
  last_check:timestamp last_check_ok:timestamp
----

== model Channel

[source,bash]
----
bin/rails g scaffold Channel \
  server:belongs_to \
  uid:string:index \
  properties:jsonb \
  --no-stylesheets --no-javascripts --no-helper
----

== Model ChannelStatistic

[source,bash]
----
bin/rails g scaffold ChannelStatistic \
  server:belongs_to \
  channel:belongs_to \
  server_uid:string:index \
  channel_uid:string:index \
  received:integer \
  sent:integer \
  error:integer \
  filtered:integer \
  queued:integer \
  --no-stylesheets --no-javascripts --no-helper
----

== Model ChannelCounter

include::partial$scaffold-channel_counter.adoc[]

see also: xref:timescale.adoc[]

.Generate Controller with action :index
[source,bash]
----
bin/rails g controller channel_counters index \
  --no-stylesheets --no-javascripts --no-helper
----

== Model Alert

[source,bash]
----
bin/rails g scaffold Alert \
  server:belongs_to \
  channel:belongs_to \
  type:string:index \
  message:text \
  --no-stylesheets --no-javascripts --no-helper
----

[cols="1,3"]
|===
|type
a|`alert`, `recovery`, `acknowledge`
|===

== Model Note

[source,bash]
----
bin/rails g scaffold Note \
  server:belongs_to \
  channel:belongs_to \
  user:belongs_to \
  type:string:index \
  --no-stylesheets --no-javascripts --no-helper
----

[cols="1,3"]
|===
|type
a|`acknowledge`, `mail`, `note`
|===

.Install ActionText
[source.bash]
----
bin/rails action_text:install
----

.app/models/note.rb
[source,ruby]
----
class Note < ApplicationRecord
  has_rich_text :message
end
----
